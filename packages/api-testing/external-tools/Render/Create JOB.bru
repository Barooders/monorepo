meta {
  name: Create JOB
  type: http
  seq: 1
}

post {
  url: https://api.render.com/v1/services/{{renderJobService}}/jobs
  body: json
  auth: none
}

headers {
  Authorization: Bearer {{renderToken}}
  Content-Type: application/json
}

body:json {
  {
    "startCommand": "yarn workspace backend console indexProduct prune --apply",
    "planId": "plan-srv-008"
  }
}

vars:post-response {
  startedJobId: res.body.id
}

script:post-response {
  res.body = {
    ...res.body,
    serviceUrl: `https://dashboard.render.com/web/${res.body.serviceId}/jobs`
  }
}

docs {
  To go check the logs you can go to :
  
  - Staging service: https://dashboard.render.com/web/srv-coc1bd779t8c73fednlg/jobs
  - Production service: https://dashboard.render.com/web/srv-coc1c2ljm4es73a1njr0/jobs
}
